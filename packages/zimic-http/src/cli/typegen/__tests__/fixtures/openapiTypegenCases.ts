import path from 'path';

import { TypegenFixtureCase } from './types';

const filtersDirectory = path.join('src', 'cli', 'typegen', '__tests__', 'fixtures', 'openapi');

const openapiTypegenFixtureCases = {
  get all() {
    return Object.keys(this)
      .filter((key) => key !== 'all')
      .sort()
      .flatMap((key) => this[key]);
  },

  simple: [
    {
      input: 'simple.yaml',
      expectedOutput: 'simple.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'simple.yaml',
      expectedOutput: 'simple.comments.ts',
      extraArguments: [],
    },
    {
      input: 'simple.yaml',
      extraArguments: ['--no-comments'],
      stdout: true,
    },
    {
      input: 'simple.yaml',
      expectedOutput: 'simple.ts',
      extraArguments: ['--no-comments'],
      url: true,
    },
    {
      input: 'simple.yaml',
      expectedOutput: 'simple.ts',
      extraArguments: ['--no-comments'],
      outputDirectoryExists: false,
    },
  ],

  pathParams: [
    {
      input: 'pathParams.yaml',
      expectedOutput: 'pathParams.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'pathParams.yaml',
      expectedOutput: 'pathParams.comments.ts',
      extraArguments: [],
    },
  ],

  searchParams: [
    {
      input: 'searchParams.yaml',
      expectedOutput: 'searchParams.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'searchParams.yaml',
      expectedOutput: 'searchParams.comments.ts',
      extraArguments: [],
    },
  ],

  headers: [
    {
      input: 'headers.yaml',
      expectedOutput: 'headers.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'headers.yaml',
      expectedOutput: 'headers.comments.ts',
      extraArguments: [],
    },
  ],

  requestBodies: [
    {
      input: 'requestBodies.yaml',
      expectedOutput: 'requestBodies.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'requestBodies.yaml',
      expectedOutput: 'requestBodies.comments.ts',
      extraArguments: [],
    },
  ],

  responses: [
    {
      input: 'responses.yaml',
      expectedOutput: 'responses.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'responses.yaml',
      expectedOutput: 'responses.comments.ts',
      extraArguments: [],
    },
  ],

  formData: [
    {
      input: 'formData.yaml',
      expectedOutput: 'formData.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'formData.yaml',
      expectedOutput: 'formData.comments.ts',
      extraArguments: [],
    },
  ],

  binary: [
    {
      input: 'binary.yaml',
      expectedOutput: 'binary.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'binary.yaml',
      expectedOutput: 'binary.comments.ts',
      extraArguments: [],
    },
  ],

  // Not pruning unused operations and components because path items are not being generated by openapi-typescript.
  // See https://github.com/openapi-ts/openapi-typescript/issues/1725
  pathItems: [
    {
      input: 'pathItems.yaml',
      expectedOutput: 'pathItems.ts',
      extraArguments: ['--no-comments', '--no-prune'],
    },
    {
      input: 'pathItems.yaml',
      expectedOutput: 'pathItems.comments.ts',
      extraArguments: ['--no-prune'],
    },
  ],

  combinations: [
    {
      input: 'combinations.yaml',
      expectedOutput: 'combinations.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'combinations.yaml',
      expectedOutput: 'combinations.comments.ts',
      extraArguments: [],
    },
  ],

  examples: [
    {
      input: 'examples.yaml',
      expectedOutput: 'examples.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'examples.yaml',
      expectedOutput: 'examples.comments.ts',
      extraArguments: [],
    },
  ],

  security: [
    {
      input: 'security.yaml',
      expectedOutput: 'security.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'security.yaml',
      expectedOutput: 'security.comments.ts',
      extraArguments: [],
    },
  ],

  webhooks: [
    {
      input: 'webhooks.yaml',
      expectedOutput: 'webhooks.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'webhooks.yaml',
      expectedOutput: 'webhooks.comments.ts',
      extraArguments: [],
    },
  ],

  filters: [
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.comments.ts',
      extraArguments: [],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.oneMethod.ts',
      extraArguments: ['--no-comments', '--filter', 'GET /users'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.multipleMethods.ts',
      extraArguments: ['--no-comments', '--filter', 'GET,PUT /users/:userId'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.wildcardMethod.ts',
      extraArguments: ['--no-comments', '--filter', '* /users/:userId'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.pathWildcard.1.ts',
      extraArguments: ['--no-comments', '--filter', 'GET *'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.pathWildcard.2.ts',
      extraArguments: ['--no-comments', '--filter', 'GET **'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.pathWildcard.3.ts',
      extraArguments: ['--no-comments', '--filter', 'GET /users**'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.pathWildcard.4.ts',
      extraArguments: ['--no-comments', '--filter', 'GET /users/**'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.pathWildcard.5.ts',
      extraArguments: ['--no-comments', '--filter', 'GET /users/**/*'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.negative.1.ts',
      extraArguments: ['--no-comments', '--filter', '!GET /users'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.negative.2.ts',
      extraArguments: ['--no-comments', '--filter', '!* /users**'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.negative.3.ts',
      extraArguments: ['--no-comments', '--filter', '!GET /users/**/*'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.empty.ts',
      extraArguments: ['--no-comments', '--filter', '!* **'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.multiple.ts',
      extraArguments: [
        '--no-comments',
        '--filter',
        'POST /*',
        '--filter',
        '* /users/**/*',
        '--filter',
        '!PATCH /users/:userId',
        '--filter',
        'DELETE /notifications',
      ],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.multipleFromFile.ts',
      extraArguments: ['--no-comments', '--filter-file', path.join(filtersDirectory, 'filters.txt')],
    },

    {
      input: 'filters.yaml',
      expectedOutput: 'filters.oneMethod.notPruned.ts',
      extraArguments: ['--no-comments', '--no-prune', '--filter', 'GET /users'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.wildcardMethod.notPruned.ts',
      extraArguments: ['--no-comments', '--no-prune', '--filter', '* /users/:userId'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.empty.notPruned.ts',
      extraArguments: ['--no-comments', '--no-prune', '--filter', '!* **'],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.multiple.notPruned.ts',
      extraArguments: [
        '--no-comments',
        '--no-prune',
        '--filter',
        'POST /users',
        '--filter',
        '* /users/**/*',
        '--filter',
        '!PATCH /users/:userId',
        '--filter',
        'DELETE /notifications',
      ],
    },
    {
      input: 'filters.yaml',
      expectedOutput: 'filters.multipleFromFile.notPruned.ts',
      extraArguments: ['--no-comments', '--no-prune', '--filter-file', path.join(filtersDirectory, 'filters.txt')],
    },
    {
      input: 'filters.yaml',
      extraArguments: ['--filter-file', path.join(filtersDirectory, 'unknown.txt')],
    },
  ],

  empty: [
    {
      input: 'empty.yaml',
      expectedOutput: 'empty.ts',
      extraArguments: ['--no-comments'],
    },
    {
      input: 'empty.yaml',
      expectedOutput: 'empty.comments.ts',
      extraArguments: [],
    },
  ],
} satisfies Record<string, TypegenFixtureCase[]>;

export default openapiTypegenFixtureCases;
